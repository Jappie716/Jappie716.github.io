<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Game Paradise â€“ Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg: #020617;
  --card-bg: rgba(30, 41, 59, 0.4);
  --primary: #2563eb;
  --accent: #60a5fa;
  --danger: #ef4444;
  --success: #22c55e;
}

* { box-sizing: border-box; }
body {
  margin: 0; font-family: 'Segoe UI', system-ui, sans-serif;
  background: #020617; color: white;
  display: flex; height: 100vh; overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 260px; min-width: 260px; background: #010409;
  padding: 20px; display: flex; flex-direction: column; border-right: 1px solid #1e293b;
}
.logo { font-weight: bold; font-size: 20px; color: var(--accent); margin-bottom: 30px; text-align: center; }

.nav-btn {
  background: transparent; padding: 12px; border-radius: 10px;
  margin-bottom: 8px; cursor: pointer; border: none; color: #94a3b8;
  text-align: left; transition: 0.2s; display: flex; align-items: center; gap: 10px;
}
.nav-btn:hover { background: #1e293b; color: white; }
.nav-btn.active { background: var(--primary); color: white; font-weight: bold; }

/* MAIN CONTENT */
.main { flex: 1; padding: 30px; overflow-y: auto; background: radial-gradient(circle at top right, #0f172a, #020617); }
.section { display: none; animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.card {
  background: var(--card-bg); backdrop-filter: blur(10px);
  padding: 25px; border-radius: 15px; border: 1px solid #1e293b;
  margin-bottom: 25px;
}

.stat-box { text-align: center; }
.stat-val { font-size: 32px; font-weight: bold; color: var(--accent); display: block; }
.stat-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }

#toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
.toast {
  background: #1e293b; color: white; padding: 15px 25px; border-radius: 10px;
  margin-bottom: 10px; border-left: 5px solid var(--primary);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

input, select {
  width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px;
  border: 1px solid #334155; background: #0f172a; color: white; outline: none;
}
.btn { padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; text-decoration: none; display: inline-block; }
.success { background: var(--success); color: white; }
.danger { background: var(--danger); color: white; }
.warning { background: var(--warning); color: white; }

table { width: 100%; border-collapse: collapse; margin-top: 10px; }
td, th { padding: 12px; border-bottom: 1px solid #1e293b; text-align: left; }
.thumb { width: 45px; height: 45px; border-radius: 6px; object-fit: cover; }
</style>
</head>
<body>

<div id="toast-container"></div>

<div class="sidebar">
  <div class="logo">ğŸ® Admin Panel</div>
  <button class="nav-btn active" id="tab-dashboard" onclick="showTab('dashboard')">ğŸ“Š Dashboard</button>
  <button class="nav-btn" id="tab-editor" onclick="showTab('editor')">âœï¸ Game Editor</button>
  <button class="nav-btn" id="tab-games" onclick="showTab('games')">ğŸ® Game Lijst</button>
  <button class="nav-btn" id="tab-categories" onclick="showTab('categories')">ğŸ“‚ CategorieÃ«n</button>
  
  <div style="margin-top: auto;">
   <button class="btn" style="width:100%; background:#1e293b; color:white; margin-bottom:10px" onclick="location.href='index.html'">ğŸŒ Bekijk Site</button>
   <button class="btn danger" style="width:100%" onclick="logout()">ğŸšª Log uit</button>
  </div>
</div>

<div class="main">
  <div id="dashboardSection" class="section" style="display:block">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
      <div class="card stat-box">
        <span class="stat-label">Totaal aantal Games</span>
        <span class="stat-val" id="statGames">0</span>
      </div>
      <div class="card stat-box">
        <span class="stat-label">Aantal CategorieÃ«n</span>
        <span class="stat-val" id="statCategories">0</span>
      </div>
    </div>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
        <h3 style="margin:0">ğŸ‘¥ Database Gebruikers</h3>
        <button class="btn" onclick="loadDatabaseView()" style="background:var(--primary); color:white; padding: 8px 15px;">ğŸ”„ Verversen</button>
      </div>
      
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr>
              <th>ID / Info</th>
              <th>Status</th>
              <th>Acties</th>
            </tr>
          </thead>
          <tbody id="dbViewTable">
            <tr><td colspan="3">Laden...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="editorSection" class="section">
    <div class="card">
        <h3>Game Toevoegen / Bewerken</h3>
        <input id="editId" placeholder="Game ID (bijv: super-cars)">
        <input id="editTitle" placeholder="Naam van de game">
        <input id="editImg" placeholder="Afbeelding URL">
        <input id="editLink" value="games/">
        <select id="editCat"></select>
        <button class="btn success" style="width:100%" onclick="saveGame()">ğŸ’¾ Game Opslaan</button>
    </div>
  </div>

  <div id="gamesSection" class="section">
    <div class="card">
      <h3>Gepubliceerde Games</h3>
      <table>
        <thead><tr><th>Beeld</th><th>Titel</th><th>Categorie</th><th>Acties</th></tr></thead>
        <tbody id="gamesList"></tbody>
      </table>
    </div>
  </div>

  <div id="categoriesSection" class="section">
    <div class="card">
      <h3>Categorie Beheer</h3>
      <input id="catId" placeholder="ID (bijv: actie)">
      <input id="catName" placeholder="Naam (bijv: Actie Spellen)">
      <button class="btn success" onclick="addCategory()">Toevoegen</button>
      <div id="categoriesList" style="margin-top:20px"></div>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA0K4geAuueVfiItB_98-LkqRTnpYNUNvM",
  authDomain: "gameparadise-80490.firebaseapp.com",
  projectId: "gameparadise-80490",
  storageBucket: "gameparadise-80490.firebasestorage.app",
  messagingSenderId: "335620903527",
  appId: "1:335620903527:web:1bc1e01a386bf6e4e7fac2"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

function notify(msg, type = 'success') {
  const container = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = 'toast';
  t.style.borderLeftColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
  t.innerText = msg;
  container.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

function showTab(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id + 'Section').style.display = 'block';
  document.getElementById('tab-' + id).classList.add('active');
}

const adminEmails = ["someoeneheilig@gmail.com", "melle1337k@gmail.com"];

auth.onAuthStateChanged(user => {
  if (user && adminEmails.includes(user.email)) {
    init();
  } else {
    location.href = "index.html";
  }
});

function init() {
  loadDatabaseView();
  
  db.collection("games").get().then(s => {
    document.getElementById('statGames').textContent = s.size;
    const list = document.getElementById('gamesList');
    list.innerHTML = "";
    s.forEach(doc => {
      const g = doc.data();
      list.innerHTML += `<tr>
        <td><img src="${g.image}" class="thumb"></td>
        <td><b>${g.title}</b><br><small>${doc.id}</small></td>
        <td>${g.category}</td>
        <td>
          <button class="btn warning" style="padding:5px 8px" onclick="editGame('${doc.id}')">âœï¸</button>
          <button class="btn danger" style="padding:5px 8px" onclick="deleteItem('games','${doc.id}')">ğŸ—‘ï¸</button>
        </td>
      </tr>`;
    });
  });

  db.collection("categories").get().then(s => {
    document.getElementById('statCategories').textContent = s.size;
    const list = document.getElementById('categoriesList');
    const select = document.getElementById('editCat');
    list.innerHTML = ""; select.innerHTML = "";
    s.forEach(doc => {
      list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #1e293b">
        <span>${doc.data().name}</span>
        <button class="btn danger" style="padding:2px 8px" onclick="deleteItem('categories','${doc.id}')">X</button>
      </div>`;
      select.innerHTML += `<option value="${doc.id}">${doc.data().name}</option>`;
    });
  });
}

function loadDatabaseView() {
  const tableBody = document.getElementById('dbViewTable');
  tableBody.innerHTML = "<tr><td colspan='3'>Laden...</td></tr>";

  db.collection("users").limit(50).get().then((querySnapshot) => {
      tableBody.innerHTML = "";
      querySnapshot.forEach((doc) => {
          const data = doc.data();
          tableBody.innerHTML += `
              <tr>
                  <td>
                      <div style="font-weight:bold">${data.email || 'Anonieme Gebruiker'}</div>
                      <small style="color:#64748b">UID: ${doc.id}</small>
                  </td>
                  <td><span style="color:var(--success)">â—</span> Online</td>
                  <td>
                      <button class="btn danger" style="padding:4px 8px; font-size:11px" onclick="deleteItem('users', '${doc.id}')">Verwijderen</button>
                  </td>
              </tr>`;
      });
      if(querySnapshot.empty) tableBody.innerHTML = "<tr><td colspan='3'>Geen gebruikers gevonden.</td></tr>";
  }).catch(err => notify("Fout: " + err.message, "danger"));
}

function saveGame() {
  const id = document.getElementById('editId').value;
  const data = {
    title: document.getElementById('editTitle').value,
    image: document.getElementById('editImg').value,
    link: document.getElementById('editLink').value,
    category: document.getElementById('editCat').value
  };
  if(!id) return notify("ID verplicht!", "danger");
  db.collection("games").doc(id).set(data).then(() => {
    notify(`Game '${data.title}' opgeslagen!`);
    init();
  });
}

function deleteItem(col, id) {
  if(confirm(`Weet je zeker dat je ${id} wilt verwijderen uit ${col}?`)) {
    db.collection(col).doc(id).delete().then(() => {
      notify("Item verwijderd", "danger");
      init();
    });
  }
}

function logout() { auth.signOut().then(() => location.href="index.html"); }
</script>
</body>
</html>
