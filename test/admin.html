<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Game Paradise ‚Äì Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg: #020617;
  --card-bg: rgba(30, 41, 59, 0.4);
  --primary: #2563eb;
  --accent: #60a5fa;
  --danger: #ef4444;
  --success: #22c55e;
}

* { box-sizing: border-box; }
body {
  margin: 0; font-family: 'Segoe UI', system-ui, sans-serif;
  background: #020617; color: white;
  display: flex; height: 100vh; overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 260px; min-width: 260px; background: #010409;
  padding: 20px; display: flex; flex-direction: column; border-right: 1px solid #1e293b;
}
.logo { font-weight: bold; font-size: 20px; color: var(--accent); margin-bottom: 30px; text-align: center; }

.nav-btn {
  background: transparent; padding: 12px; border-radius: 10px;
  margin-bottom: 8px; cursor: pointer; border: none; color: #94a3b8;
  text-align: left; transition: 0.2s; display: flex; align-items: center; gap: 10px;
}
.nav-btn:hover { background: #1e293b; color: white; }
.nav-btn.active { background: var(--primary); color: white; font-weight: bold; }

/* MAIN CONTENT */
.main { flex: 1; padding: 30px; overflow-y: auto; background: radial-gradient(circle at top right, #0f172a, #020617); }
.section { display: none; animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.card {
  background: var(--card-bg); backdrop-filter: blur(10px);
  padding: 25px; border-radius: 15px; border: 1px solid #1e293b;
  margin-bottom: 25px;
}

/* DATABASE EMBED BIJSNIJDEN */
.db-wrapper {
  width: 100%;
  height: 650px;
  overflow: hidden; /* Dit zorgt voor het 'bijsnijden' */
  position: relative;
  background: #0f172a;
  border-radius: 10px;
  border: 1px solid #1e293b;
}

/* We verschuiven de iframe om de menu's van Google te verbergen */
.db-iframe {
  position: absolute;
  top: -120px;  /* Verbergt de Google header */
  left: -200px; /* Verbergt de Google sidebar */
  width: calc(100% + 200px);
  height: calc(100% + 120px);
  border: none;
}

.stat-box { text-align: center; }
.stat-val { font-size: 32px; font-weight: bold; color: var(--accent); display: block; }
.stat-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }

/* TOAST MELDINGEN */
#toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
.toast {
  background: #1e293b; color: white; padding: 15px 25px; border-radius: 10px;
  margin-bottom: 10px; border-left: 5px solid var(--primary);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

/* EDITOR PREVIEW */
.editor-layout { display: grid; grid-template-columns: 1fr 320px; gap: 30px; }
.preview-pane { display: flex; flex-direction: column; align-items: center; border-left: 1px solid #1e293b; padding-left: 30px; }
.game-preview-card {
  width: 200px; background: #020617; border-radius: 12px;
  overflow: hidden; border: 1px solid #334155;
}
.game-preview-card img { width: 100%; height: 120px; object-fit: cover; background: #0f172a; }
.game-preview-card h4 { margin: 0; padding: 12px; text-align: center; font-size: 14px; }

input, select {
  width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px;
  border: 1px solid #334155; background: #0f172a; color: white; outline: none;
}
.btn { padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; text-decoration: none; display: inline-block; }
.success { background: var(--success); color: white; }
.danger { background: var(--danger); color: white; }
.warning { background: var(--warning); color: white; }

table { width: 100%; border-collapse: collapse; }
td, th { padding: 12px; border-bottom: 1px solid #1e293b; text-align: left; }
.thumb { width: 45px; height: 45px; border-radius: 6px; object-fit: cover; }
</style>
</head>
<body>

<div id="toast-container"></div>

<div class="sidebar">
  <div class="logo">üéÆ Admin Panel</div>
  <button class="nav-btn active" id="tab-dashboard" onclick="showTab('dashboard')">üìä Dashboard</button>
  <button class="nav-btn" id="tab-editor" onclick="showTab('editor')">‚úèÔ∏è Game Editor</button>
  <button class="nav-btn" id="tab-games" onclick="showTab('games')">üéÆ Game Lijst</button>
  <button class="nav-btn" id="tab-categories" onclick="showTab('categories')">üìÇ Categorie√´n</button>
  
  <div style="margin-top: auto;">
   <button class="btn" style="width:100%; background:#1e293b; color:white; margin-bottom:10px" onclick="location.href='index.html'">üåê Bekijk Site</button>
   <button class="btn danger" style="width:100%" onclick="logout()">üö™ Log uit</button>
  </div>
</div>

<div class="main">
  <div id="dashboardSection" class="section" style="display:block">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
      <div class="card stat-box">
        <span class="stat-label">Totaal aantal Games</span>
        <span class="stat-val" id="statGames">0</span>
      </div>
      <div class="card stat-box">
        <span class="stat-label">Aantal Categorie√´n</span>
        <span class="stat-val" id="statCategories">0</span>
      </div>
    </div>

    <div class="card" style="padding: 15px;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
        <h3 style="margin:0">üìÇ Database Manager (Firestore)</h3>
        <a href="https://console.firebase.google.com/u/0/project/gameparadise-80490/firestore/databases/-default-/data" target="_blank" class="btn" style="background:var(--primary); color:white; padding:5px 15px; font-size:12px">Open in nieuw tabblad</a>
      </div>
      
      <div class="card">
  <div style="display:flex; justify-content:space-between; margin-bottom:15px">
    <h3>üë• Database Overzicht</h3>
    <button class="btn" onclick="loadDatabaseView()" style="background:var(--primary); color:white">üîÑ Verversen</button>
  </div>
  
  <div style="overflow-x:auto;">
    <table style="width:100%; border-collapse: collapse;">
      <thead>
        <tr style="background: rgba(255,255,255,0.05);">
          <th>ID / E-mail</th>
          <th>Status</th>
          <th>Acties</th>
        </tr>
      </thead>
      <tbody id="dbViewTable">
        </tbody>
    </table>
  </div>
</div>
      <p style="color:#64748b; font-size:12px; margin-top:10px;">Opmerking: Als de database hierboven niet laadt, blokkeert Google de weergave binnen andere websites. Gebruik dan de knop rechtsboven.</p>
    </div>
  </div>

  <div id="editorSection" class="section">
    <div class="card">
      <div class="editor-layout">
        <div class="form-side">
          <h3 id="editorTitle">Game Toevoegen</h3>
          <input id="editId" placeholder="Game ID (bijv: super-cars)">
          <input id="editTitle" placeholder="Naam van de game" oninput="updatePreview()">
          <input id="editImg" placeholder="Afbeelding URL" oninput="updatePreview()">
          <input id="editLink" value="games/" oninput="updatePreview()">
          <select id="editCat"></select>
          <button class="btn success" style="width:100%" onclick="saveGame()">üíæ Game Opslaan</button>
        </div>
        <div class="preview-pane">
          <p style="color:#64748b; font-size:11px; margin-bottom:10px">PREVIEW</p>
          <div class="game-preview-card">
            <img id="preImg" src="https://via.placeholder.com/200x120?text=Geen+Foto">
            <h4 id="preTitle">Titel</h4>
          </div>
          <button class="btn" style="margin-top:20px; background:#1e293b; color:white" onclick="resetEditor()">üßπ Reset</button>
        </div>
      </div>
    </div>
  </div>

  <div id="gamesSection" class="section">
    <div class="card">
      <h3>Gepubliceerde Games</h3>
      <table>
        <thead><tr><th>Beeld</th><th>Titel</th><th>Categorie</th><th>Acties</th></tr></thead>
        <tbody id="gamesList"></tbody>
      </table>
    </div>
  </div>

  <div id="categoriesSection" class="section">
    <div class="card">
      <h3>Nieuwe Categorie</h3>
      <input id="catId" placeholder="ID (bijv: actie)">
      <input id="catName" placeholder="Naam (bijv: Actie Spellen)">
      <button class="btn success" onclick="addCategory()">Toevoegen</button>
    </div>
    <div class="card" id="categoriesList"></div>
  </div>
</div>

<script>
// --- CONFIG ---
const firebaseConfig = {
  apiKey: "AIzaSyA0K4geAuueVfiItB_98-LkqRTnpYNUNvM",
  authDomain: "gameparadise-80490.firebaseapp.com",
  projectId: "gameparadise-80490",
  storageBucket: "gameparadise-80490.firebasestorage.app",
  messagingSenderId: "335620903527",
  appId: "1:335620903527:web:1bc1e01a386bf6e4e7fac2"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

function notify(msg, type = 'success') {
  const container = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = 'toast';
  t.style.borderLeftColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
  t.innerText = msg;
  container.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

function showTab(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id + 'Section').style.display = 'block';
  document.getElementById('tab-' + id).classList.add('active');
}

const adminEmails = ["someoeneheilig@gmail.com", "melle1337k@gmail.com"];

auth.onAuthStateChanged(user => {
  if (user && adminEmails.includes(user.email)) {
    init();
  } else {
    location.href = "index.html";
  }
});

function init() {
  db.collection("games").get().then(s => {
    document.getElementById('statGames').textContent = s.size;
    const list = document.getElementById('gamesList');
    list.innerHTML = "";
    s.forEach(doc => {
      const g = doc.data();
      list.innerHTML += `<tr>
        <td><img src="${g.image}" class="thumb"></td>
        <td><b>${g.title}</b><br><small>${doc.id}</small></td>
        <td>${g.category}</td>
        <td>
          <button class="btn warning" style="padding:5px 8px" onclick="editGame('${doc.id}')">‚úèÔ∏è</button>
          <button class="btn danger" style="padding:5px 8px" onclick="deleteItem('games','${doc.id}')">üóëÔ∏è</button>
        </td>
      </tr>`;
    });
  });

  db.collection("categories").get().then(s => {
    document.getElementById('statCategories').textContent = s.size;
    const list = document.getElementById('categoriesList');
    const select = document.getElementById('editCat');
    list.innerHTML = ""; select.innerHTML = "";
    s.forEach(doc => {
      list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #1e293b">
        <span>${doc.data().name}</span>
        <button class="btn danger" style="padding:2px 8px" onclick="deleteItem('categories','${doc.id}')">X</button>
      </div>`;
      select.innerHTML += `<option value="${doc.id}">${doc.data().name}</option>`;
    });
  });
}

function updatePreview() {
  document.getElementById('preImg').src = document.getElementById('editImg').value || 'https://via.placeholder.com/200x120?text=Geen+Foto';
  document.getElementById('preTitle').textContent = document.getElementById('editTitle').value || "Titel";
}

function saveGame() {
  const id = document.getElementById('editId').value;
  const data = {
    title: document.getElementById('editTitle').value,
    image: document.getElementById('editImg').value,
    link: document.getElementById('editLink').value,
    category: document.getElementById('editCat').value
  };
  if(!id) return notify("ID verplicht!", "danger");
  db.collection("games").doc(id).set(data).then(() => {
    notify(`Game '${data.title}' succesvol opgeslagen!`);
    resetEditor();
    init();
  });
}

function editGame(id) {
  db.collection("games").doc(id).get().then(doc => {
    const g = doc.data();
    document.getElementById('editId').value = id;
    document.getElementById('editId').disabled = true;
    document.getElementById('editTitle').value = g.title;
    document.getElementById('editImg').value = g.image;
    document.getElementById('editLink').value = g.link;
    document.getElementById('editCat').value = g.category;
    document.getElementById('editorTitle').textContent = "Bewerken: " + g.title;
    updatePreview();
    showTab('editor');
  });
}

function resetEditor() {
  document.getElementById('editId').value = "";
  document.getElementById('editId').disabled = false;
  document.getElementById('editTitle').value = "";
  document.getElementById('editImg').value = "";
  document.getElementById('editLink').value = "games/";
  updatePreview();
}

function addCategory() {
  const id = document.getElementById('catId').value;
  const name = document.getElementById('catName').value;
  db.collection("categories").doc(id).set({name}).then(() => {
    notify(`Categorie '${name}' toegevoegd!`);
    init();
  });
}

function deleteItem(col, id) {
  if(confirm("Zeker weten?")) {
    db.collection(col).doc(id).delete().then(() => {
      notify(`${id} verwijderd uit ${col}`, 'danger');
      init();
    });
  }
}

function logout() { auth.signOut().then(() => location.href="index.html"); }
  function loadDatabaseView() {
    const tableBody = document.getElementById('dbViewTable');
    tableBody.innerHTML = "<tr><td colspan='3'>Laden...</td></tr>";

    // Verander "users" naar de naam van de collectie die je wilt zien (bijv. "aanvragen")
    db.collection("users").limit(20).get().then((querySnapshot) => {
        tableBody.innerHTML = "";
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const row = `
                <tr>
                    <td>
                        <div style="font-weight:bold">${data.email || 'Geen email'}</div>
                        <small style="color:#64748b">${doc.id}</small>
                    </td>
                    <td><span class="status-dot online"></span> Actief</td>
                    <td>
                        <button class="btn danger" style="padding:4px 8px; font-size:11px" onclick="deleteItem('users', '${doc.id}')">Verwijderen</button>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
        
        if(querySnapshot.empty) {
            tableBody.innerHTML = "<tr><td colspan='3'>Geen gegevens gevonden in deze collectie.</td></tr>";
        }
    }).catch(err => {
        notify("Fout bij laden database: " + err.message, "danger");
    });
}

// Zorg dat de data geladen wordt als de pagina start
// Voeg dit toe in je init() functie:
// loadDatabaseView();
</script>
</body>
</html>
