<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Game Paradise ‚Äì Admin Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg: #020617;
  --card-bg: rgba(30, 41, 59, 0.5);
  --primary: #2563eb;
  --accent: #60a5fa;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(180deg, #020617, #0b0f19);
  color: white;
  display: flex;
  height: 100vh;
}

/* SIDEBAR */
.sidebar {
  width: 240px;
  background: var(--bg);
  padding: 15px;
  display: flex;
  flex-direction: column;
  border-right: 1px solid #1e293b;
}

.nav-btn {
  background: transparent;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: all .2s;
  border: none;
  color: #94a3b8;
  text-align: left;
  font-size: 14px;
}

.nav-btn:hover { background: #1e293b; color: white; }
.nav-btn.active { background: var(--primary); color: white; font-weight: bold; }

/* MAIN CONTENT */
.main { flex: 1; padding: 30px; overflow-y: auto; }
.section { display: none; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.card {
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #1e293b;
  margin-bottom: 20px;
}

/* DASHBOARD STATS */
.stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
.stat-box { background: var(--card-bg); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #1e293b; }
.stat-box h2 { font-size: 32px; margin: 0; color: var(--accent); }

/* FORMS & INPUTS */
.flex-form { display: flex; gap: 20px; }
.form-inputs { flex: 2; }
.preview-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-left: 1px solid #334155; padding-left: 20px; }

input, select {
  width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155;
  background: #0f172a; color: white; outline: none;
}
input:focus { border-color: var(--primary); }

.btn {
  padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: transform 0.1s;
}
.btn:active { transform: scale(0.95); }
.primary { background: var(--primary); color: white; }
.green { background: #16a34a; color: white; }
.red { background: #dc2626; color: white; }

/* GAME TABLE */
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th { text-align: left; color: #64748b; padding: 10px; font-size: 13px; }
td { padding: 12px 10px; border-bottom: 1px solid #1e293b; font-size: 14px; }
.thumb { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }

/* MINI PREVIEW CARD (Matches Index style) */
.mini-card {
  width: 140px; background: #020617; border-radius: 10px; overflow: hidden;
  border: 1px solid #334155; pointer-events: none;
}
.mini-card img { width: 100%; height: 80px; object-fit: cover; background: #1e293b; }
.mini-card h4 { margin: 0; padding: 5px; text-align: center; font-size: 11px; }
</style>
</head>

<body>

<div class="sidebar">
  <div class="logo">üõ†Ô∏è Admin Pro</div>
  <button class="nav-btn active" onclick="showTab('dashboard', this)">üìä Dashboard</button>
  <button class="nav-btn" onclick="showTab('games', this)">üéÆ Games beheren</button>
  <button class="nav-btn" onclick="showTab('categories', this)">üìÇ Categorie√´n</button>
  
  <button class="btn" style="margin-top:auto; background: #1e293b; color: white;" onclick="location.href='index.html'">‚Üê Site bekijken</button>
  <button class="btn red" style="margin-top: 10px;" onclick="logout()">Uitloggen</button>
</div>

<div class="main">
  <h2 id="pageTitle">Dashboard</h2>

  <div id="dashboardSection" class="section" style="display:block">
    <div class="stats">
      <div class="stat-box"> <h2 id="statGames">0</h2> <p>Games</p> </div>
      <div class="stat-box"> <h2 id="statCategories">0</h2> <p>Categorie√´n</p> </div>
      <div class="stat-box"> <h2>‚ö°</h2> <p>Systeem Online</p> </div>
    </div>

    <div class="card">
      <h3>‚ö° Quick Edit (Snel aanpassen)</h3>
      <p style="color: #94a3b8; font-size: 13px;">Vul een bestaand Game ID in om direct de link of afbeelding te wijzigen.</p>
      <div style="display: flex; gap: 10px; align-items: flex-end;">
        <div style="flex: 1;">
          <label style="font-size: 12px;">Game ID</label>
          <input id="quickId" placeholder="bijv: greedy-snakes">
        </div>
        <div style="flex: 2;">
          <label style="font-size: 12px;">Nieuwe Afbeelding URL</label>
          <input id="quickImg" placeholder="https://...">
        </div>
        <button class="btn primary" onclick="quickUpdate()">Update</button>
      </div>
    </div>
  </div>

  <div id="gamesSection" class="section">
    <div class="card">
      <h3>Nieuwe Game Toevoegen</h3>
      <div class="flex-form">
        <div class="form-inputs">
          <input id="gameId" placeholder="Game ID (uniek, bijv: drive-mad)">
          <input id="gameTitle" placeholder="Titel van de game" oninput="updatePreview()">
          <input id="gameImage" placeholder="Afbeelding URL" oninput="updatePreview()">
          <input id="gameLink" placeholder="Bestandsnaam (bijv: drive-mad.html)">
          <select id="gameCategory"></select>
          <button class="btn green" style="width: 100%; margin-top: 10px;" onclick="addGame()">üöÄ Game Publiceren</button>
        </div>
        <div class="preview-area">
          <p style="font-size: 12px; color: #64748b; margin-bottom: 10px;">LIVE PREVIEW</p>
          <div class="mini-card" id="liveCard">
            <img id="prevImg" src="">
            <h4 id="prevTitle">Titel</h4>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Alle Games</h3>
      <table id="gamesTable">
        <thead>
          <tr>
            <th>Beeld</th>
            <th>Titel (ID)</th>
            <th>Categorie</th>
            <th>Actie</th>
          </tr>
        </thead>
        <tbody id="gamesList"></tbody>
      </table>
    </div>
  </div>

  <div id="categoriesSection" class="section">
    <div class="card">
      <h3>Nieuwe Categorie</h3>
      <input id="catId" placeholder="ID (bijv: race)">
      <input id="catName" placeholder="Naam (bijv: Race Games)">
      <button class="btn green" onclick="addCategory()">Opslaan</button>
    </div>
    <div class="card">
      <div id="categoriesList"></div>
    </div>
  </div>
</div>

<script>
// -- FIREBASE CONFIG --
const firebaseConfig = {
  apiKey: "AIzaSyA0K4geAuueVfiItB_98-LkqRTnpYNUNvM",
  authDomain: "gameparadise-80490.firebaseapp.com",
  projectId: "gameparadise-80490",
  storageBucket: "gameparadise-80490.firebasestorage.app",
  messagingSenderId: "335620903527",
  appId: "1:335620903527:web:1bc1e01a386bf6e4e7fac2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const ADMIN_EMAIL = "someoeneheilig@gmail.com";

/* TABS LOGIC */
function showTab(section, btn) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(section + 'Section').style.display = 'block';
  btn.classList.add('active');
  document.getElementById('pageTitle').textContent = btn.textContent;
}

/* LIVE PREVIEW */
function updatePreview() {
  document.getElementById('prevImg').src = document.getElementById('gameImage').value;
  document.getElementById('prevTitle').textContent = document.getElementById('gameTitle').value || "Titel";
}

/* AUTH CHECK */
auth.onAuthStateChanged(user => {
  if (!user || user.email !== ADMIN_EMAIL) {
    location.href = "index.html";
  } else {
    init();
  }
});

function logout() { auth.signOut().then(() => location.href = "index.html"); }

/* DATA LOADERS */
function init() {
  loadStats();
  loadCategories();
  loadGames();
}

function loadStats() {
  db.collection("games").get().then(s => document.getElementById('statGames').textContent = s.size);
  db.collection("categories").get().then(s => document.getElementById('statCategories').textContent = s.size);
}

function loadCategories() {
  const list = document.getElementById("categoriesList");
  const select = document.getElementById("gameCategory");
  list.innerHTML = ""; select.innerHTML = "";

  db.collection("categories").get().then(snap => {
    snap.forEach(doc => {
      const d = doc.data();
      list.innerHTML += `<div class="list-item" style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #1e293b;">
        <span>${d.name} <small>(${doc.id})</small></span>
        <button class="btn red" onclick="deleteItem('categories', '${doc.id}')">Verwijder</button>
      </div>`;
      select.innerHTML += `<option value="${doc.id}">${d.name}</option>`;
    });
  });
}

function loadGames() {
  const list = document.getElementById("gamesList");
  list.innerHTML = "";
  db.collection("games").get().then(snap => {
    snap.forEach(doc => {
      const g = doc.data();
      list.innerHTML += `
        <tr>
          <td><img src="${g.image}" class="thumb"></td>
          <td><b>${g.title}</b><br><small>${doc.id}</small></td>
          <td>${g.category}</td>
          <td><button class="btn red" onclick="deleteItem('games', '${doc.id}')">X</button></td>
        </tr>`;
    });
  });
}

/* CRUD ACTIONS */
function addGame() {
  const id = document.getElementById('gameId').value.trim();
  if(!id) return alert("ID verplicht");
  const data = {
    title: document.getElementById('gameTitle').value,
    image: document.getElementById('gameImage').value,
    link: document.getElementById('gameLink').value,
    category: document.getElementById('gameCategory').value
  };
  db.collection("games").doc(id).set(data).then(() => {
    alert("Game toegevoegd!");
    location.reload();
  });
}

function quickUpdate() {
  const id = document.getElementById('quickId').value.trim();
  const newImg = document.getElementById('quickImg').value.trim();
  if(!id || !newImg) return alert("Vul beide velden in");
  
  db.collection("games").doc(id).update({ image: newImg })
    .then(() => { alert("Afbeelding ge√ºpdatet!"); location.reload(); })
    .catch(() => alert("Game ID niet gevonden"));
}

function addCategory() {
  const id = document.getElementById('catId').value.trim();
  db.collection("categories").doc(id).set({ name: document.getElementById('catName').value })
    .then(() => location.reload());
}

function deleteItem(col, id) {
  if(confirm("Zeker weten?")) db.collection(col).doc(id).delete().then(() => location.reload());
}
</script>
</body>
</html>
